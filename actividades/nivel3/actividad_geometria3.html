<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Actividad: Per√≠metros y √Åreas | MatePlay</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="../../css/style.css">

  <!-- ‚≠ê SISTEMA DE LOGROS -->
  <script src="../../js/logros.js"></script>
</head>

<body>

<!-- NAV -->
<header>
  <nav class="nav">
    <div class="logo">
      <div class="logo-icon">M</div>
      <span>MatePlay</span>
    </div>
    <div class="nav-links">
      <a href="../../nivel3.html">Volver al Nivel 3</a>
      <a href="../../logros.html">Logros ‚≠ê</a>
    </div>
  </nav>
</header>

<main>
  <!-- T√çTULO -->
  <section>
    <h1 class="section-title">Per√≠metros y √Åreas</h1>
    <p class="section-subtitle">
      Observa la figura y responde la pregunta.  
      Las figuras pueden ser rect√°ngulos, tri√°ngulos o c√≠rculos.
    </p>
  </section>

  <!-- ACTIVIDAD -->
  <section>
    <div class="game-container">

      <!-- IZQUIERDA -->
      <div>
        <span class="game-level-label">Nivel 3 ¬∑ Geometr√≠a</span>

        <canvas id="figCanvas" width="300" height="250"
                style="background:#f9fafb;border-radius:12px;margin-bottom:1rem;">
        </canvas>

        <p id="figPregunta" class="game-question"></p>

        <div id="figOpciones" class="game-options"></div>

        <p id="figResultado" class="game-result"></p>

        <button class="btn btn-primary" onclick="nuevaFigura()">
          üîÑ Nueva figura
        </button>
      </div>

      <!-- DERECHA -->
      <aside class="game-side">
        <p class="game-side-title">F√≥rmulas √∫tiles</p>
        <p><strong>Rect√°ngulo:</strong></p>
        <p>√Årea = base √ó altura</p>
        <p>Per√≠metro = 2(base + altura)</p>
        <hr>
        <p><strong>Tri√°ngulo equil√°tero:</strong></p>
        <p>√Årea = (lado¬≤ √ó ‚àö3) / 4</p>
        <p>Per√≠metro = 3 √ó lado</p>
        <hr>
        <p><strong>C√≠rculo:</strong></p>
        <p>√Årea = œÄr¬≤</p>
        <p>Per√≠metro = 2œÄr</p>
      </aside>

    </div>
  </section>

  <section style="margin-top:2rem;">
    <button class="btn btn-secondary" onclick="window.location.href='../nivel3.html'">
      ‚¨Ö Volver al Nivel 3
    </button>
  </section>
</main>

<footer>
  MatePlay ¬∑ Actividad de Geometr√≠a ¬∑ 2025
</footer>

<!-- ‚≠ê POPUP -->
<script>
  function popupEstrella() {
    let pop = document.createElement("div");
    pop.textContent = "‚≠ê ¬°Ganaste una estrella!";
    pop.style.position = "fixed";
    pop.style.bottom = "25px";
    pop.style.right = "25px";
    pop.style.padding = "15px 20px";
    pop.style.background = "#4f46e5";
    pop.style.color = "white";
    pop.style.borderRadius = "10px";
    pop.style.boxShadow = "0 4px 12px rgba(0,0,0,0.25)";
    pop.style.zIndex = "999";
    pop.style.opacity = "1";
    pop.style.transition = "opacity 1s ease";

    document.body.appendChild(pop);

    setTimeout(() => {
      pop.style.opacity = "0";
      setTimeout(() => pop.remove(), 1000);
    }, 1500);
  }
</script>

<!-- SCRIPT GEOMETR√çA -->
<script>
  const canvas = document.getElementById("figCanvas");
  const ctx = canvas.getContext("2d");

  let respuestaCorrecta = 0;

  function nuevaFigura() {
    ctx.clearRect(0, 0, canvas.width, canvas.height);

    const figuras = ["rectangulo", "triangulo", "circulo"];
    const figura = figuras[Math.floor(Math.random() * figuras.length)];

    let preguntaTipo = Math.random() < 0.5 ? "area" : "perimetro";

    let base, altura, lado, radio;

    if (figura === "rectangulo") {
      base = Math.floor(Math.random() * 15) + 5;
      altura = Math.floor(Math.random() * 15) + 5;
      dibujarRectangulo(base, altura);

      respuestaCorrecta = preguntaTipo === "area"
        ? base * altura
        : 2 * (base + altura);

    } else if (figura === "triangulo") {
      lado = Math.floor(Math.random() * 10) + 5;
      dibujarTriangulo(lado);

      respuestaCorrecta = preguntaTipo === "area"
        ? Math.round((lado * lado * Math.sqrt(3)) / 4)
        : 3 * lado;

    } else {
      radio = Math.floor(Math.random() * 8) + 3;
      dibujarCirculo(radio);

      respuestaCorrecta = preguntaTipo === "area"
        ? Math.round(Math.PI * radio * radio)
        : Math.round(2 * Math.PI * radio);
    }

    document.getElementById("figPregunta").textContent =
      figura === "rectangulo"
        ? preguntaTipo === "area"
          ? `¬øCu√°l es el √°rea del rect√°ngulo?`
          : `¬øCu√°l es el per√≠metro del rect√°ngulo?`
        : figura === "triangulo"
          ? preguntaTipo === "area"
            ? `¬øCu√°l es el √°rea del tri√°ngulo equil√°tero?`
            : `¬øCu√°l es el per√≠metro del tri√°ngulo equil√°tero?`
          : preguntaTipo === "area"
            ? `¬øCu√°l es el √°rea del c√≠rculo?`
            : `¬øCu√°l es el per√≠metro del c√≠rculo?`;

    generarOpciones(respuestaCorrecta);
    document.getElementById("figResultado").textContent = "";
  }

  function generarOpciones(correcta) {
    const cont = document.getElementById("figOpciones");
    cont.innerHTML = "";

    const opciones = new Set();
    opciones.add(correcta);

    while (opciones.size < 4) {
      let desvio = Math.floor(Math.random() * 15) - 7;
      let posible = correcta + desvio;
      if (posible > 0) opciones.add(posible);
    }

    const mezcladas = Array.from(opciones).sort(() => Math.random() - 0.5);

    mezcladas.forEach(op => {
      const btn = document.createElement("button");
      btn.className = "game-option";
      btn.textContent = op;
      btn.onclick = () => evaluar(op);
      cont.appendChild(btn);
    });
  }

  function evaluar(op) {
    const res = document.getElementById("figResultado");

    if (op == respuestaCorrecta) {
      res.textContent = "¬°Correcto! üéâ";
      res.className = "game-result ok";

      // ‚≠ê Registra estrella global
      if (typeof sumarEstrella === "function") {
        sumarEstrella("nivel3_geometria");
      }

      popupEstrella();

    } else {
      res.textContent = "Incorrecto ‚ùå";
      res.className = "game-result bad";
    }
  }

  function dibujarRectangulo(base, altura) {
    ctx.strokeStyle = "#1f2937";
    ctx.lineWidth = 3;
    ctx.strokeRect(60, 40, base * 8, altura * 8);

    ctx.font = "14px Arial";
    ctx.fillStyle = "#111827";
    ctx.fillText(`Base: ${base}`, 60, 35);
    ctx.fillText(`Altura: ${altura}`, 60 + base * 8 + 10, 40 + (altura * 8)/2);
  }

  function dibujarTriangulo(lado) {
    const h = (lado * Math.sqrt(3)) / 2;

    ctx.beginPath();
    ctx.moveTo(150, 40);
    ctx.lineTo(150 - lado * 4, 40 + h * 4);
    ctx.lineTo(150 + lado * 4, 40 + h * 4);
    ctx.closePath();
    ctx.strokeStyle = "#1f2937";
    ctx.lineWidth = 3;
    ctx.stroke();

    ctx.font = "14px Arial";
    ctx.fillText(`Lado: ${lado}`, 140, 35);
  }

  function dibujarCirculo(radio) {
    ctx.beginPath();
    ctx.arc(150, 120, radio * 10, 0, Math.PI * 2);
    ctx.strokeStyle = "#1f2937";
    ctx.lineWidth = 3;
    ctx.stroke();

    ctx.font = "14px Arial";
    ctx.fillText(`Radio: ${radio}`, 150 - 25, 25);
  }

  nuevaFigura();
</script>

</body>
</html>
