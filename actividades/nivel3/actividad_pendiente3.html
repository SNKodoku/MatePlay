<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Actividad: Pendiente entre dos puntos | MatePlay</title>
  <meta name="viewport" content="width=device-width,initial-scale=1.0">
  <link rel="stylesheet" href="../../css/style.css">
</head>

<body>

<!-- NAV -->
<header>
  <nav class="nav">
    <div class="logo">
      <div class="logo-icon">M</div>
      <span>MatePlay</span>
    </div>
    <div class="nav-links">
      <a href="../../nivel3.html">Volver al Nivel 3</a>
      <a href="../../logros.html">Logros ‚≠ê</a>
    </div>
  </nav>
</header>

<main>

  <section>
    <h1 class="section-title">Pendiente entre dos puntos</h1>
    <p class="section-subtitle">
      Observa los puntos y la recta. Luego elige la pendiente correcta.
    </p>
  </section>

  <section>
    <div class="game-container">

      <!-- IZQUIERDA -->
      <div>
        <span class="game-level-label">Nivel 3 ¬∑ √Ålgebra y Geometr√≠a</span>

        <canvas id="pendCanvas" width="350" height="300"
                style="background:#f9fafb;border-radius:12px;margin-bottom:1rem;">
        </canvas>

        <p id="pendPregunta" class="game-question"></p>

        <div id="pendOpciones" class="game-options"></div>

        <p id="pendResultado" class="game-result"></p>

        <button class="btn btn-primary" onclick="nuevaPendiente()">
          üîÑ Nuevo ejercicio
        </button>
      </div>

      <!-- DERECHA -->
      <aside class="game-side">
        <p class="game-side-title">F√≥rmula de la pendiente:</p>
        <p><strong>m = (y‚ÇÇ ‚àí y‚ÇÅ) / (x‚ÇÇ ‚àí x‚ÇÅ)</strong></p>
        <hr>
        <p>Si sube hacia la derecha ‚Üí pendiente positiva.</p>
        <p>Si baja hacia la derecha ‚Üí pendiente negativa.</p>
        <p>Si es horizontal ‚Üí pendiente = 0.</p>
      </aside>

    </div>
  </section>

  <section style="margin-top:2rem;">
    <button class="btn btn-secondary" onclick="window.location.href='../nivel3.html'">
      ‚¨Ö Volver al Nivel 3
    </button>
  </section>

</main>

<footer>
  MatePlay ¬∑ Pendiente ¬∑ 2025
</footer>

<!-- ‚≠ê SISTEMA DE LOGROS -->
<script src="../../js/logros.js"></script>

<!-- ‚≠ê POPUP ESTRELLA -->
<script>
  function popupEstrella() {
    let pop = document.createElement("div");
    pop.textContent = "‚≠ê ¬°Ganaste una estrella!";
    pop.style.position = "fixed";
    pop.style.bottom = "25px";
    pop.style.right = "25px";
    pop.style.padding = "15px 20px";
    pop.style.background = "#4f46e5";
    pop.style.color = "white";
    pop.style.borderRadius = "10px";
    pop.style.boxShadow = "0 4px 12px rgba(0,0,0,0.25)";
    pop.style.zIndex = "999";
    pop.style.opacity = "1";
    pop.style.transition = "opacity 1s ease";

    document.body.appendChild(pop);

    setTimeout(() => {
      pop.style.opacity = "0";
      setTimeout(() => pop.remove(), 1000);
    }, 1500);
  }
</script>

<!-- ‚≠ê SCRIPT PRINCIPAL -->
<script>
  const canvas = document.getElementById("pendCanvas");
  const ctx = canvas.getContext("2d");

  let pendienteCorrecta = 0;

  function nuevaPendiente() {
    ctx.clearRect(0, 0, canvas.width, canvas.height);
    dibujarEjes();

    // Generar puntos aleatorios
    let x1 = Math.floor(Math.random() * 9) - 4;
    let y1 = Math.floor(Math.random() * 9) - 4;

    let x2 = Math.floor(Math.random() * 9) - 4;
    let y2 = Math.floor(Math.random() * 9) - 4;

    while (x1 === x2) x2 = Math.floor(Math.random() * 9) - 4;

    dibujarPunto(x1, y1, "#ef4444");
    dibujarPunto(x2, y2, "#3b82f6");

    dibujarRectaPorPuntos(x1, y1, x2, y2);

    pendienteCorrecta = (y2 - y1) / (x2 - x1);
    pendienteCorrecta = Math.round(pendienteCorrecta * 10) / 10;

    document.getElementById("pendPregunta").textContent =
      `Puntos: (${x1}, ${y1}) y (${x2}, ${y2}). ¬øCu√°l es la pendiente?`;

    generarOpcionesPend(pendienteCorrecta);

    document.getElementById("pendResultado").textContent = "";
  }

  /* === DIBUJOS === */

  function dibujarEjes() {
    const W = canvas.width, H = canvas.height;

    ctx.strokeStyle = "#9ca3af";
    ctx.lineWidth = 1;

    ctx.beginPath();
    ctx.moveTo(0, H/2);
    ctx.lineTo(W, H/2);
    ctx.stroke();

    ctx.beginPath();
    ctx.moveTo(W/2, 0);
    ctx.lineTo(W/2, H);
    ctx.stroke();
  }

  function dibujarPunto(x, y, color) {
    const px = canvas.width/2 + x * 20;
    const py = canvas.height/2 - y * 20;

    ctx.fillStyle = color;
    ctx.beginPath();
    ctx.arc(px, py, 5, 0, Math.PI * 2);
    ctx.fill();
  }

  function dibujarRectaPorPuntos(x1, y1, x2, y2) {
    const W = canvas.width, H = canvas.height;

    let m = (y2 - y1) / (x2 - x1);
    let b = y1 - m * x1;

    let xx1 = -10;
    let yy1 = m * xx1 + b;

    let xx2 = 10;
    let yy2 = m * xx2 + b;

    ctx.strokeStyle = "#2563eb";
    ctx.lineWidth = 2;

    ctx.beginPath();
    ctx.moveTo(W/2 + xx1*20, H/2 - yy1*20);
    ctx.lineTo(W/2 + xx2*20, H/2 - yy2*20);
    ctx.stroke();
  }

  /* === OPCIONES Y EVALUACI√ìN === */

  function generarOpcionesPend(correcta) {
    const cont = document.getElementById("pendOpciones");
    cont.innerHTML = "";

    const opciones = new Set([correcta]);

    while (opciones.size < 4) {
      let desvio = (Math.floor(Math.random() * 11) - 5) / 2;
      let posible = Math.round((correcta + desvio) * 10) / 10;
      opciones.add(posible);
    }

    const mezcladas = Array.from(opciones).sort(() => Math.random() - 0.5);

    mezcladas.forEach(op => {
      const btn = document.createElement("button");
      btn.className = "game-option";
      btn.textContent = op;
      btn.onclick = () => evaluarPend(op);
      cont.appendChild(btn);
    });
  }

  function evaluarPend(valor) {
    const res = document.getElementById("pendResultado");

    if (valor === pendienteCorrecta) {
      res.textContent = "¬°Correcto! üéâ";
      res.className = "game-result ok";

      if (typeof sumarEstrella === "function") {
        sumarEstrella("nivel3_pendiente");
      }

      popupEstrella();
    } else {
      res.textContent = "Incorrecto ‚ùå";
      res.className = "game-result bad";
    }
  }

  nuevaPendiente();
</script>

</body>
</html>
